import React, { useState } from "react";
import { motion } from "framer-motion";
import { GoogleMap, LoadScript, Marker, Autocomplete } from "@react-google-maps/api";

export default function AddEventForm() {
  const [position, setPosition] = useState({ lat: 28.6139, lng: 77.2090 }); // Default: Delhi
  const [mapRef, setMapRef] = useState(null);
  const [tickets, setTickets] = useState([
    { name: "VIP", price: 500, limit: 1500 },
    { name: "Standard", price: 200, limit: 2000 },
  ]);

  const addTicket = () => {
    setTickets([...tickets, { name: "", price: 0, limit: 0 }]);
  };

  const handlePlaceChanged = (autocomplete) => {
    const place = autocomplete.getPlace();
    if (place.geometry) {
      setPosition({
        lat: place.geometry.location.lat(),
        lng: place.geometry.location.lng(),
      });
      mapRef.panTo(place.geometry.location);
    }
  };

  return (
    <motion.div
      className="max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
    >
      <h2 className="text-2xl font-bold mb-4">🎉 Add New Event</h2>

      {/* Event Info */}
      <div className="grid grid-cols-2 gap-4">
        <input type="text" placeholder="Event Name" className="border rounded p-2" />
        <input type="date" className="border rounded p-2" />
        <textarea placeholder="Description" className="col-span-2 border rounded p-2"></textarea>
      </div>

      {/* Map with Autocomplete */}
      <div className="my-4">
        <LoadScript googleMapsApiKey="YOUR_GOOGLE_API_KEY" libraries={["places"]}>
          <Autocomplete onLoad={(a) => (window.auto = a)} onPlaceChanged={() => handlePlaceChanged(window.auto)}>
            <input type="text" placeholder="Search location..." className="w-full border rounded p-2 mb-2" />
          </Autocomplete>
          <GoogleMap
            mapContainerStyle={{ height: "300px", width: "100%" }}
            center={position}
            zoom={14}
            onLoad={map => setMapRef(map)}
          >
            <Marker position={position} draggable={true} onDragEnd={(e) =>
              setPosition({ lat: e.latLng.lat(), lng: e.latLng.lng() })
            } />
          </GoogleMap>
        </LoadScript>
      </div>

      {/* Ticket Section */}
      <h3 className="text-lg font-semibold mt-4">🎟️ Ticket Types</h3>
      {tickets.map((t, i) => (
        <div key={i} className="flex gap-2 mt-2">
          <input type="text" placeholder="Ticket Name" value={t.name} className="border p-2 flex-1" />
          <input type="number" placeholder="Price" value={t.price} className="border p-2 w-24" />
          <input type="number" placeholder="Max Limit" value={t.limit} className="border p-2 w-32" />
        </div>
      ))}
      <button onClick={addTicket} className="mt-2 bg-indigo-500 text-white px-4 py-2 rounded-lg">+ Add Ticket</button>

      {/* Questions Section */}
      <h3 className="text-lg font-semibold mt-6">📝 Registration Questions</h3>
      <div className="grid grid-cols-4 gap-2 mt-2">
        <label><input type="checkbox" /> Name</label>
        <label><input type="checkbox" /> Email</label>
        <label><input type="checkbox" /> Phone</label>
        <label><input type="checkbox" /> Gender</label>
      </div>

      <button className="mt-6 bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition">
        🚀 Create Event
      </button>
    </motion.div>
  );
}
