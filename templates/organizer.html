{% extends "base.html" %} 
{% load static %} 
{% block title %}My Events - EventHive{% endblock %} 

{% block content %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

<div class="relative min-h-screen animated-bg py-16 overflow-hidden">
  <!-- Floating Gradient Circles -->
  <div class="absolute top-20 left-10 w-72 h-72 bg-gradient-to-r from-pink-300 to-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse"></div>
  <div class="absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-r from-indigo-300 to-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-pulse"></div>

  <div class="relative container mx-auto px-6">
    <!-- Header -->
    <div class="flex flex-wrap justify-between items-center gap-4 mb-14">
      <h1 class="text-4xl font-extrabold text-indigo-900 drop-shadow flex items-center gap-2">
        üé§ My Events
        <span class="px-3 py-1 text-xs bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full shadow">
          Dashboard
        </span>
      </h1>
      <a href="{% url 'create_event' %}" 
         class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 text-white px-8 py-3 rounded-xl shadow-lg font-semibold hover:scale-105 transition">
        + Create Event
      </a>
    </div>

    <!-- Analytics Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 mb-16">
      <!-- Total Events -->
      <div class="analytics-card" data-aos="fade-up" data-aos-duration="700">
        <div class="icon bg-gradient-to-r from-indigo-500 to-purple-600"><i class="bi bi-calendar-event text-xl"></i></div>
        <div>
          <p class="text-sm text-gray-500">Total Events</p>
          <h2 class="counter text-3xl font-bold text-gray-900">{{ total_events }}</h2>
          <div class="progress"><div style="width: 80%"></div></div>
        </div>
      </div>

      <!-- Published -->
      <div class="analytics-card" data-aos="fade-up" data-aos-duration="800">
        <div class="icon bg-gradient-to-r from-green-400 to-green-600"><i class="bi bi-check-circle text-xl"></i></div>
        <div>
          <p class="text-sm text-gray-500">Published</p>
          <h2 class="counter text-3xl font-bold text-gray-900">{{ published_events }}</h2>
          <div class="progress"><div style="width: 65%"></div></div>
        </div>
      </div>

      <!-- Draft -->
      <div class="analytics-card" data-aos="fade-up" data-aos-duration="900">
        <div class="icon bg-gradient-to-r from-yellow-400 to-yellow-600"><i class="bi bi-hourglass-split text-xl"></i></div>
        <div>
          <p class="text-sm text-gray-500">Draft</p>
          <h2 class="counter text-3xl font-bold text-gray-900">{{ draft_events }}</h2>
          <div class="progress"><div style="width: 30%"></div></div>
        </div>
      </div>

      <!-- Tickets Sold -->
      <div class="analytics-card" data-aos="fade-up" data-aos-duration="1000">
        <div class="icon bg-gradient-to-r from-pink-400 to-red-500"><i class="bi bi-ticket-perforated text-xl"></i></div>
        <div>
          <p class="text-sm text-gray-500">Tickets Sold</p>
          <h2 class="counter text-3xl font-bold text-gray-900">{{ tickets_sold }}</h2>
          <div class="progress"><div style="width: 90%"></div></div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap gap-4 mb-14 bg-white/70 backdrop-blur-md border border-gray-200 p-6 rounded-xl shadow-md">
      <select class="filter-input">
        <option>Category</option>
        <option>Music</option>
        <option>Sports</option>
        <option>Exhibition</option>
      </select>
      <input type="date" class="filter-input" />
      <div class="flex items-center border border-gray-300 rounded-xl shadow-sm overflow-hidden w-80 bg-white">
        <i class="bi bi-search text-gray-400 pl-3"></i>
        <input type="text" placeholder="Search events..." class="px-3 py-2 w-full focus:outline-none text-gray-700" />
      </div>
    </div>

    <!-- Events Grid -->
    <div class="flex flex-wrap gap-10">
      {% for event in events %}
      <div class="event-card group w-full sm:w-1/2 md:w-1/3 lg:w-1/4" data-aos="zoom-in" data-aos-duration="900">
        <!-- Banner -->
        <div class="relative overflow-hidden rounded-t-2xl">
          {% if event.banner_image %}
          <img src="{{ event.banner_image.url }}" alt="{{ event.title }}" 
               class="w-full h-52 object-cover transition-transform duration-500 group-hover:scale-110" />
          {% else %}
          <img src="{% static 'images/default-banner.jpg' %}" alt="Default Banner"
               class="w-full h-52 object-cover transition-transform duration-500 group-hover:scale-110" />
          {% endif %}
          <span class="status-badge {% if event.is_published %}published{% else %}draft{% endif %}">
            {% if event.is_published %} ‚úÖ Published {% else %} ‚è≥ Draft {% endif %}
          </span>
        </div>

        <!-- Content -->
        <div class="p-6 flex flex-col h-full">
          <h3 class="text-lg font-semibold text-gray-900 truncate group-hover:text-indigo-600 transition">{{ event.title }}</h3>
          <p class="text-sm text-gray-600 line-clamp-2 mt-2">{{ event.description }}</p>
          <div class="mt-4 text-xs text-gray-500 space-y-1">
            <p class="flex items-center gap-1"><i class="bi bi-calendar-event"></i> {{ event.start_date|date:"M d, Y" }}</p>
            <p class="flex items-center gap-1"><i class="bi bi-geo-alt"></i> {{ event.location }}</p>
          </div>

          <!-- Stats Chips -->
          <div class="flex gap-2 mt-4">
            <span class="px-3 py-1 bg-indigo-100 text-indigo-600 text-xs rounded-full">üéü {{ event.tickets.count|default:0 }} Tickets</span>
            <span class="px-3 py-1 bg-pink-100 text-pink-600 text-xs rounded-full">üëÄ {{ event.views|default:0 }} Views</span>
          </div>

          <!-- Buttons -->
          <div class="mt-auto flex justify-between gap-3 pt-5">
            <a href="{% url 'event_detail' event.id %}" class="btn-view">View</a>
            <a href="{% url 'edit_event' event.id %}" class="btn-edit">Edit</a>
            <form action="{% url 'delete_event' event.id %}" method="post" 
                  onsubmit="return confirm('‚ö†Ô∏è Delete this event?');" class="w-full">
              {% csrf_token %}
              <button type="submit" class="btn-delete w-full">Delete</button>
            </form>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="col-span-4 text-center text-gray-500">You haven‚Äôt created any events yet.</p>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="flex justify-center mt-16">
      <nav class="flex gap-2">
        {% if events.has_previous %}
        <a href="?page={{ events.previous_page_number }}" class="page-btn">‚Üê</a>
        {% endif %}
        {% for num in events.paginator.page_range %}
          {% if events.number == num %}
          <span class="page-btn-active">{{ num }}</span>
          {% elif num > events.number|add:'-2' and num < events.number|add:'2' %}
          <a href="?page={{ num }}" class="page-btn">{{ num }}</a>
          {% endif %}
        {% endfor %}
        {% if events.has_next %}
        <a href="?page={{ events.next_page_number }}" class="page-btn">‚Üí</a>
        {% endif %}
      </nav>
    </div>
  </div>

  <!-- Floating Create Button -->
  <a href="{% url 'create_event' %}" class="fab"><i class="bi bi-plus-lg text-xl"></i></a>

  <!-- Extra Styling -->
  <style>
    .animated-bg {
      background: linear-gradient(-45deg, #dbeafe, #f3e8ff, #e0e7ff, #fef2f2);
      background-size: 400% 400%;
      animation: gradientMove 15s ease infinite;
    }
    @keyframes gradientMove {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .analytics-card {
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform .3s;
    }
    .analytics-card:hover { transform: translateY(-4px) scale(1.02); }
    .analytics-card .icon {
      padding: .75rem;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .progress {
      margin-top: .5rem;
      width: 100%; height: 6px;
      background: #e5e7eb;
      border-radius: 9999px;
      overflow: hidden;
    }
    .progress div {
      height: 6px;
      border-radius: 9999px;
      background: linear-gradient(to right, #6366f1, #ec4899);
    }

    .event-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      transition: .3s;
      display: flex; flex-direction: column;
    }
    .event-card:hover { transform: translateY(-6px) scale(1.03); }
    .status-badge {
      position: absolute; top: .75rem; right: .75rem;
      padding: .25rem .75rem; font-size: .75rem; font-weight: 600;
      border-radius: 9999px;
    }
    .status-badge.published { background: linear-gradient(to right, #34d399, #059669); color: #fff; }
    .status-badge.draft { background: linear-gradient(to right, #facc15, #f59e0b); color: #111; }

    .btn-view, .btn-edit, .btn-delete {
      flex: 1; text-align: center;
      padding: .5rem; font-size: .85rem; font-weight: 600;
      border-radius: .5rem; transition: .3s;
    }
    .btn-view { background: #eef2ff; color: #4338ca; }
    .btn-view:hover { background: #c7d2fe; }
    .btn-edit { background: #fef9c3; color: #92400e; }
    .btn-edit:hover { background: #fde047; }
    .btn-delete { background: #fee2e2; color: #991b1b; }
    .btn-delete:hover { background: #fca5a5; }

    .page-btn {
      padding: .5rem 1rem;
      border-radius: 9999px;
      background: #f3f4f6;
      transition: .3s;
    }
    .page-btn:hover { background: #6366f1; color: white; }
    .page-btn-active {
      padding: .5rem 1rem;
      border-radius: 9999px;
      background: #6366f1; color: white; font-weight: 600;
    }

    .fab {
      position: fixed; bottom: 2rem; right: 2rem;
      width: 3.5rem; height: 3.5rem;
      border-radius: 50%;
      background: linear-gradient(to right, #6366f1, #ec4899);
      display: flex; align-items: center; justify-content: center;
      color: white;
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      transition: .3s;
    }
    .fab:hover { transform: scale(1.1) rotate(10deg); }

    .filter-input {
      padding: .5rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: .75rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      transition: .2s;
    }
    .filter-input:focus { outline: none; box-shadow: 0 0 0 2px #818cf8; }
  </style>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ once: true });

    // Animated Counter
    document.querySelectorAll(".counter").forEach((counter) => {
      let target = +counter.innerText, count = 0, step = target / 60;
      let loop = setInterval(() => {
        count += step;
        if (count >= target) {
          counter.innerText = target;
          clearInterval(loop);
        } else {
          counter.innerText = Math.ceil(count);
        }
      }, 20);
    });
  </script>
</div>
{% endblock %}
