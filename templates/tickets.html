{% extends 'base.html' %}

{% block title %}Book Tickets - EventHive{% endblock %}

{% block content %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<div class="min-h-screen bg-gradient-to-br from-indigo-100 via-white to-purple-100 flex justify-center px-4">
  <div class="bg-white/80 backdrop-blur-xl shadow-2xl rounded-3xl w-full max-w-3xl p-10 border border-gray-200 mt-16 mb-16 transition transform hover:scale-[1.01]"
       data-aos="zoom-in" data-aos-duration="1000">
    
    <!-- Header -->
    <div class="text-center mb-12">
      <h2 class="text-5xl font-extrabold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent drop-shadow"
          data-aos="fade-down">
        üéü Book Your Tickets
      </h2>
      <p class="text-gray-600 mt-3 text-lg" data-aos="fade-up" data-aos-delay="200">
        Select your tickets and see the total in real time üöÄ
      </p>
    </div>

    <!-- Tickets List -->
    <div class="space-y-8">
      
      <!-- Standard Ticket -->
      <div class="flex items-center justify-between bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl p-6 shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 hover:scale-[1.02]"
           data-aos="fade-right" data-aos-delay="300">
        <div>
          <h3 class="text-2xl font-bold text-gray-800">Standard</h3>
          <p class="text-sm text-gray-500">Sales ends on <span class="font-medium">01/09/2025 20:00</span></p>
        </div>
        <div class="flex items-center gap-6">
          <p class="text-xl font-semibold text-indigo-600">‚Çπ 0.00</p>
          <div class="flex items-center border rounded-xl overflow-hidden shadow-sm">
            <button onclick="updateQty('standard', -1)" 
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 transition">-</button>
            <input id="standardQty" type="text" value="0" readonly 
                   class="w-14 text-center border-l border-r bg-white font-semibold text-gray-700">
            <button onclick="updateQty('standard', 1)" 
                    class="px-4 py-2 bg-gray-200 hover:bg-gray-300 transition">+</button>
          </div>
        </div>
      </div>

      <!-- VIP Ticket -->
      <div class="flex items-center justify-between bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-6 shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 hover:scale-[1.02]"
           data-aos="fade-left" data-aos-delay="500">
        <div>
          <h3 class="text-2xl font-bold text-gray-800">VIP</h3>
          <p class="text-sm text-gray-500">Sales ends on <span class="font-medium">05/09/2025 23:00</span></p>
        </div>
        <div class="flex items-center gap-6">
          <p class="text-xl font-semibold text-yellow-600">‚Çπ 500.00</p>
          <div class="flex items-center border rounded-xl overflow-hidden shadow-sm">
            <button onclick="updateQty('vip', -1)" 
                    class="px-4 py-2 bg-yellow-200 hover:bg-yellow-300 transition">-</button>
            <input id="vipQty" type="text" value="0" readonly 
                   class="w-14 text-center border-l border-r bg-white font-semibold text-gray-700">
            <button onclick="updateQty('vip', 1)" 
                    class="px-4 py-2 bg-yellow-200 hover:bg-yellow-300 transition">+</button>
          </div>
        </div>
      </div>

    </div>

    <!-- Coupon Section -->
    <div class="mt-8 p-6 rounded-2xl bg-gray-50 border shadow-inner text-center" data-aos="fade-up" data-aos-delay="550">
      <h3 class="text-xl font-bold mb-3">üéÅ Apply Promo Code</h3>
      <div class="flex justify-center gap-3">
        <input id="couponCode" type="text" placeholder="Enter code..."
               class="px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 outline-none">
        <button onclick="applyCoupon()" 
                class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg shadow hover:scale-105 transition">
          Apply
        </button>
      </div>
      <p id="couponMsg" class="mt-2 text-sm font-medium"></p>
    </div>

    <!-- Total Price Section -->
    <div class="mt-10 p-6 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-xl text-center"
         data-aos="fade-up" data-aos-delay="600">
      <h3 class="text-2xl font-bold">üí∞ Total Price</h3>
      <p id="totalPrice" class="text-3xl font-extrabold mt-2">‚Çπ 0.00</p>
    </div>

    <!-- Footer Buttons -->
    <div class="flex justify-between items-center mt-12" data-aos="zoom-in" data-aos-delay="700">
      <a href="{% url 'home' %}" 
         class="px-6 py-3 bg-gray-200 rounded-xl shadow hover:bg-gray-300 transition transform hover:-translate-y-1">
        ‚ùå Close
      </a>
      
      <button onclick="goToAttendeeTickets()" 
              class="px-10 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-lg font-semibold rounded-xl shadow-lg hover:scale-105 transition transform duration-300">
        ‚úÖ Register
      </button>
    </div>

  </div>
</div>

<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>AOS.init({ once: true });</script>

<script>
let discount = 0; // global discount percentage

function updateQty(ticketType, change) {
  let input = document.getElementById(ticketType + "Qty");
  let current = parseInt(input.value) || 0;
  let newValue = current + change;
  if (newValue < 0) newValue = 0;

  input.style.transform = "scale(1.2)";
  setTimeout(() => { input.style.transform = "scale(1)"; }, 150);

  input.value = newValue;

  calculateTotal();
}

function applyCoupon() {
  const code = document.getElementById("couponCode").value.trim().toUpperCase();
  const msg = document.getElementById("couponMsg");

  if (code === "EVENT10") {
    discount = 0.10; // 10% off
    msg.innerText = "‚úÖ Promo applied: 10% discount!";
    msg.className = "mt-2 text-green-600 font-semibold";
  } 
  else if (code === "VIP50") {
    discount = 0.50; // 50% off
    msg.innerText = "‚úÖ Promo applied: 50% discount!";
    msg.className = "mt-2 text-green-600 font-semibold";
  }
  else {
    discount = 0;
    msg.innerText = "‚ùå Invalid promo code.";
    msg.className = "mt-2 text-red-600 font-semibold";
  }

  calculateTotal();
}

function calculateTotal() {
  const standard = parseInt(document.getElementById("standardQty").value) || 0;
  const vip = parseInt(document.getElementById("vipQty").value) || 0;

  let total = (standard * 0) + (vip * 500);

  if (discount > 0) {
    total = total - (total * discount);
  }

  document.getElementById("totalPrice").innerText = "‚Çπ " + total.toFixed(2);
}

function goToAttendeeTickets() {
  const standard = document.getElementById("standardQty").value;
  const vip = document.getElementById("vipQty").value;

  if (standard == 0 && vip == 0) {
    alert("‚ö†Ô∏è Please select at least one ticket.");
    return;
  }

  const eventId = "{{ event.id }}";
  window.location.href = `/attendee-tickets/${eventId}/?standard_qty=${standard}&vip_qty=${vip}&discount=${discount}`;
}
</script>
{% endblock %}
